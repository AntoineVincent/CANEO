{% extends 'base.html.twig' %}

{% block body %}

	<div class="col-md-12">
		<div class="col-md-12">
			<h3 class="form-title">Liste des Ventes en cours</h3>
			<table id="table">
				<thead>
					<tr>
						<th class="mytable">Nom Du Produit</th>
		       			<th class="mytable">Prix unitaire</th>
		       			{% if user.type == "fournisseur" or user.type == "admin" %}
		       				<th class="mytable">Total commande</th>
		       			{% endif %}
		       			{% if user.type == "acheteur" %}
		       				<th class="mytable">Vos Commandes</th>
		       			{% endif %}
		       			<th class="mytable">Fournisseur</th>
		       			<th class="mytable">Temps Restant</th>
		       			{% if user.type == "acheteur" %}
		       				<th class="mytable">Passer Commande</th>
		       			{% endif %}
		       			<th>Voir la vente</th>
					</tr>
				</thead>
				<tbody>
					{% if tabenchere is empty %}
						<tr>
							<th>Aucun données pour le moment</th>
						</tr>
					{% endif %}

					{% for enchere in tabenchere %}
							<tr>
				       			<th class="mytable">{{ enchere.produit }}</th>
				       			<th class="mytable">{{ enchere.prix }}</th>
				       			{% if user.type == "fournisseur" or user.type == "admin" %}
				       				<th class="mytable">{{ enchere.totalCommande }}</th>
				       			{% endif %}
		       					{% if user.type == "acheteur" %}
				       				<th class="mytable">{{ enchere.commandeUser }}</th>
				       			{% endif %}
				       			<th class="mytable"><img src="{{ asset('uploads/logo/' ~ enchere.logoFournisseur) }}" class="logo-pict-tab"></th>
				       			<th class="mytable" id="{{ enchere.id }}"></th>
				       			{% if user.type == "acheteur" %}
				       				<th class="mytable"><input type="text" name="test" id="input{{ enchere.id }}"></th>
				       			{% endif %}
				       			<input type="hidden" class="state" name="state" id="state" value="{{ enchere.id }}">
				       			<th><a href="{{ path('fiche_enchere', { 'idenchere': enchere.id }) }}">Voir <span class="glyphicon glyphicon-zoom-in"></span></a></th>
				   			</tr>
				   			<script type="text/javascript">

								var currentdate = new Date();
								var dd = currentdate.getDate();
								var mm = currentdate.getMonth(); //January is 0!
								var yyyy = currentdate.getFullYear();

								var datefin = new Date({{ enchere.annee }}, {{ enchere.mois }}, {{ enchere.jour }});

								$('#{{ enchere.id }}').countdown({until: datefin, compact: true, format: 'dHMS', onExpiry: sellOver, alwaysExpire: true, expiryText: "Vente Terminée"}); 

								function sellOver() { 
									var state = $('#state').val();

								    $.ajax({
						              type: "POST",
						              url: "{{ path('sellOver') }}", 
						              dataType: "json",
						              data: {state : state},
						              success : function(response) {
						              	console.log(response);
						              }
						            }); 
								}
							</script>
					{% endfor %}
				</tbody>
			</table>

			<script>
				$(document).ready( function () {
		    		$('#table').DataTable();
				} );
			</script>
		</div>
	</div>

{% endblock %}